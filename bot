import os #для того чтобы работать с токеном из ТГ, без этого бот не будет знать свой ключ
import logging #для логирования чтобы бот показываал ошибки в случан чего и я мог работать с ними 
import requests #чтобы отправлять запросы HTTP и работать с ИИ

from dotenv import load_dotenv #чтобы код мог читать .env файл в котором будет мой токен от ТГ бота и api ключ от ИИ
from telegram import Update #я создал класс который будет работать с сообщениями пользователя
from telegram.ext import ApplicationBuilder, CommandHandler, Messanger, filters, ContextTypes # 1 создает объект или ядро бота, 2 просто реагирует на команды типа start, 3 реагирует на сообщ и фотоб 4 фильтрует входящие сообщ, 4 для контекста сохраняя историю переписки
  
load_dotenv() #использую эту функцию чтобы подгрузить .env файл
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
HF_TOKEN = os.getenv("HUGGINGFACE_API_TOKEN")     # токен телеграмма и ИИ

#настраиваем логирование с помощью функции basicConfig где level=logging.INFO включает в себе все важные события программы 
logging.basicConfig(level=logging.INFO)

#Заголовки для моих запросов к ИИ без них не будет дотупа к нему
HEADERS = {"Authorization": f"Bearer {HF_TOKEN}"}

#функции для ИИ
def hf_text_query(prompt: str):

	 url="https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2"
	#указывани адрес модели Mistral-7B-Instruct-v0.2
	 
	payload = {"inputs": prompt, "parameters": {"max_new_tokens": 200}} 
	#payload это тело вопроса нашему боту, ключи: "inputs": prompt - сюда я подставляю вопрос, "parameters": {"max_new_tokens": 200} -  это настройки генерации ответа, а max_new_tokens=200 означает, что ответ может содержать максимум 200

   	 resp = requests.post(url, headers=HEADERS, json=payload, timeout=60)
	#здесь мы уже реально отправляем запрос к ИИ, где requests.post это функция из requests, отправлящая пост запрос с телом, json=payload превращает payload в JSON и отправляет, timeout=60 ждёт максимум 60 секунд

   	 return resp.json()[0]["generated_text"]
	#return возвращает ответ мне, а resp — это объект ответа, .json() метод бкрущий ответ и превращает его из JSON в словарь
